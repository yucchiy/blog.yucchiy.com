{"componentChunkName":"component---src-templates-post-tsx","path":"/2020/10/scripting-marker/","result":{"data":{"markdownRemark":{"html":"<p>Unity 2019.1から、Timelineで任意のメソッドを呼び出すSignalsという仕組みが導入されました。\n開発中に、これスクリプトで追加したくなったので、その方法について記載します。</p>\n<h2 id=\"signalsとは\" style=\"position:relative;\"><a href=\"#signals%E3%81%A8%E3%81%AF\" aria-label=\"signalsとは permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Signalsとは？</h2>\n<p>SignalsはTimelineから指定したフレームにTimeline外の特定の処理を行うための機能です。Animationについて知見のある方は、Timelineにおける<a href=\"https://docs.unity3d.com/Manual/script-AnimationWindowEvent.html\">AnimationEvent</a>という理解で概ね問題ないと思います。</p>\n<p>下図の赤枠内にマークが設定されてますが、これがSignalです。タイムライン中にSignalを仕込むことができます。そのSignalから任意のメソッドを呼び出したり、Receiverを用意することで、Signalの発火タイミングを受け取ることができます。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/013ab50ef64bb20b6459750fa814b6f0/e548f/marker-in-timeline.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQY0zXG626CMABAYZ5miTqFUkBLKTfl0hZwuHti9v5vcZa47MeXc4LPZaYrNCrc45sKWxnGsqDTil4rTBzSpJI6lWgRUiYxVSoppXi0PWWYOMJIiTkpgtsx4StPeJEH3k8xr5ngLYv4Nor7ueHedfwMA4sUDNsn7H7z4A5bfLhjFnvs8wZ/2GFESDBazXVdOXc9pqop64aqrinbC/XgqQaPu32wrCt28rhpws8T83XBes/oHG7ydKMlThKCUAnyXJNlGWma/kkSVKVRvSFtFPlF0VhN4wrOU0nrisf/a31B2WsiEfEL4iiKiqcLxVYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Timeline Marker\"\n        title=\"Timeline Marker\"\n        src=\"/static/013ab50ef64bb20b6459750fa814b6f0/5a190/marker-in-timeline.png\"\n        srcset=\"/static/013ab50ef64bb20b6459750fa814b6f0/772e8/marker-in-timeline.png 200w,\n/static/013ab50ef64bb20b6459750fa814b6f0/e17e5/marker-in-timeline.png 400w,\n/static/013ab50ef64bb20b6459750fa814b6f0/5a190/marker-in-timeline.png 800w,\n/static/013ab50ef64bb20b6459750fa814b6f0/e548f/marker-in-timeline.png 975w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Timeline Marker</p></figcaption>\n  </figure></p>\n<p>Timelineを使っているとAnimationEventに相当する機能を実装したくなることがありますが、これを実現するために独自のTrack実装することになります。ただ任意のメソッドを呼び出すために独自Trackを実装するのは地味に大変なので、個人的にはこのような用途では有用だと感じています。</p>\n<h2 id=\"signalsをスクリプトから追加する\" style=\"position:relative;\"><a href=\"#signals%E3%82%92%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%8B%E3%82%89%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\" aria-label=\"signalsをスクリプトから追加する permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Signalsをスクリプトから追加する</h2>\n<p>今回は、下記のSignalクラスを<strong>スクリプトからTimelineに追加する</strong>ことをゴールとします。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>Playables</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>Timeline</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Serializable</span></span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyNotification</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Marker</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">INotification</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">PropertyName</span> id <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>作成するエディタ拡張は下記動画の通りです。</p>\n<p><img src=\"/5d548cdf7c0c13e0093cf815aa7e9185/signal-editor.gif\" alt=\"Signalをスクリプトから追加する様子\"></p>\n<h3 id=\"markertrack\" style=\"position:relative;\"><a href=\"#markertrack\" aria-label=\"markertrack permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MarkerTrack</h3>\n<p>Signalを追加するには、まずタイムラインにMarkerTrackを作成する必要があります。MarkerTrackはエディター中のTimelineビューの下図赤枠のことを指します。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/545bb10b2f243fd2f270ec4642369bad/966c1/marker-track.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz43Oy07DMBAFUP8MjsfPJo7duE7SR9QHCLWs+P8/uSjBC1IhweLozuLOaFi3y+j3B8S0Qx5HbFNCm3ocb+/ohj1q79GEiKYNaEKAcZtvm6LM2rmlx95yh1PjcI4ej8OA1xRxDg0+LxPu+xGH1uPaj5iiX5xCgyn4pX+J67xFD5ZlhUQcSXB04gVpwdFriaOReBjCY6NxN4QPS7gXI3FsS78r5plxkqjkGieCsg7aWhilYLWB1XphCpKq9NfJpJR4RkRw1sJaC0EEqeYDcmXuqV+wefmZEGI5ppQC5xxCEKqq+hdmyyc/GWNQ1zWGYUDOGTn3Jf/2BbAl24Y9rMoSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Timeline AssetのMarker Track\"\n        title=\"Timeline AssetのMarker Track\"\n        src=\"/static/545bb10b2f243fd2f270ec4642369bad/5a190/marker-track.png\"\n        srcset=\"/static/545bb10b2f243fd2f270ec4642369bad/772e8/marker-track.png 200w,\n/static/545bb10b2f243fd2f270ec4642369bad/e17e5/marker-track.png 400w,\n/static/545bb10b2f243fd2f270ec4642369bad/5a190/marker-track.png 800w,\n/static/545bb10b2f243fd2f270ec4642369bad/c1b63/marker-track.png 1200w,\n/static/545bb10b2f243fd2f270ec4642369bad/29007/marker-track.png 1600w,\n/static/545bb10b2f243fd2f270ec4642369bad/966c1/marker-track.png 1694w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Timeline AssetのMarker Track</p></figcaption>\n  </figure></p>\n<p>Marker TrackはTimeline Asset作成直後には作成されていません。この状態でスクリプトからSignalを追加しようとすると、null reference exceptionを吐くため、事前に作成しておく必要があります。</p>\n<p>Trackは、上図の上中央のピンのアイコンをクリックしてはじめてMarker Trackを表示した際に作成されます。また、スクリプトでも下記のように追加できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">// assetはTimelineAsset</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> timelineAsset <span class=\"token operator\">=</span> asset <span class=\"token keyword\">as</span> <span class=\"token class-name\">TimelineAsset</span><span class=\"token punctuation\">;</span>\nAssert<span class=\"token punctuation\">.</span><span class=\"token function\">IsNotNull</span><span class=\"token punctuation\">(</span>timelineAsset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Marker Trackを追加する</span>\ntimelineAsset<span class=\"token punctuation\">.</span><span class=\"token function\">CreateMarkerTrack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>作成済みの状態で<code>CreateMarkerTrack</code>呼び出すと2重にTrackを作成しそうですが、Marker Trackは、Timeilne Asset中で1つ保持するような仕組みになっているため問題ありません。\n具体的には、<code>CreateMarkerTrack</code>は下記のような実装になっています。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">CreateMarkerTrack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// メンバー変数で1つMarkerTrackを保持している</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_MarkerTrack <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        m_MarkerTrack <span class=\"token operator\">=</span> <span class=\"token generic-method\"><span class=\"token function\">CreateInstance</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>MarkerTrack<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        TimelineCreateUtilities<span class=\"token punctuation\">.</span><span class=\"token function\">SaveAssetIntoObject</span><span class=\"token punctuation\">(</span>m_MarkerTrack<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        m_MarkerTrack<span class=\"token punctuation\">.</span>parent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// This name will show up in the bindings list if it contains signals</span>\n        m_MarkerTrack<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Markers\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"signalを追加する\" style=\"position:relative;\"><a href=\"#signal%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\" aria-label=\"signalを追加する permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Signalを追加する</h3>\n<p>あとは、Signalをスクリプトで追加します。具体的には、上記で作成したMarker Trackの<code>CreateMarker&#x3C;T></code>を呼び出します。\nTimeline Asset内のMarker Trackは<code>markerTrack</code>プロパティでアクセスできます。（参考: <a href=\"https://docs.unity3d.com/Packages/com.unity.timeline@1.0/api/UnityEngine.Timeline.TimelineAsset.html#UnityEngine_Timeline_TimelineAsset_markerTrack\">Class TimelineAsset | Package Manager UI website</a>）</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">// 戻り値は追加したマーカー</span>\ntimelineAsset<span class=\"token punctuation\">.</span>markerTrack<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">CreateMarker</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>MyNotification<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>引数にはSignalをタイムライン中のどこに追加するかを秒数を指定します。\n前述した通り、Marker Trackを作成してない場合は<code>markerTrack</code>が<strong>nullになっているので注意が必要です</strong>。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Signalをスクリプトから追加する方法を紹介しました。最後に、今回実装したコードの全容を示します。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEditor</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>Assertions</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>Playables</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>Timeline</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">Editor</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyNotificationEditor</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">EditorWindow</span></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">MenuItem</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"Window/MyNotification Editor\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> window <span class=\"token operator\">=</span>\n                <span class=\"token punctuation\">(</span>MyNotificationEditor<span class=\"token punctuation\">)</span> EditorWindow<span class=\"token punctuation\">.</span><span class=\"token function\">GetWindow</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">MyNotificationEditor</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            window<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnGUI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            _asset <span class=\"token operator\">=</span>\n                <span class=\"token punctuation\">(</span>PlayableAsset<span class=\"token punctuation\">)</span> EditorGUILayout<span class=\"token punctuation\">.</span><span class=\"token function\">ObjectField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"target\"</span><span class=\"token punctuation\">,</span>\n                    _asset<span class=\"token punctuation\">,</span>\n                    <span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">PlayableAsset</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_asset <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                _time <span class=\"token operator\">=</span> EditorGUILayout<span class=\"token punctuation\">.</span><span class=\"token function\">DoubleField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"time\"</span><span class=\"token punctuation\">,</span> _time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>GUILayout<span class=\"token punctuation\">.</span><span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Add a marker\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">AddMyNotificationMarker</span><span class=\"token punctuation\">(</span>_asset<span class=\"token punctuation\">,</span> _time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">AddMyNotificationMarker</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PlayableAsset</span> asset<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">double</span></span> time<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> timelineAsset <span class=\"token operator\">=</span> asset <span class=\"token keyword\">as</span> <span class=\"token class-name\">TimelineAsset</span><span class=\"token punctuation\">;</span>\n            Assert<span class=\"token punctuation\">.</span><span class=\"token function\">IsNotNull</span><span class=\"token punctuation\">(</span>timelineAsset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timelineAsset<span class=\"token punctuation\">.</span>markerTrack <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                timelineAsset<span class=\"token punctuation\">.</span><span class=\"token function\">CreateMarkerTrack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 戻り値は追加したマーカー</span>\n            timelineAsset<span class=\"token punctuation\">.</span>markerTrack<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">CreateMarker</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>MyNotification<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token class-name\">PlayableAsset</span> _asset <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">double</span></span> _time <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h3>\n<ul>\n<li><a href=\"https://docs.unity3d.com/Packages/com.unity.timeline@1.0/api/UnityEngine.Timeline.MarkerTrack.html\">Class MarkerTrack | Package Manager UI website</a>\n<ul>\n<li>MarkerTrackの公式ドキュメント</li>\n</ul>\n</li>\n<li><a href=\"http://tsubakit1.hateblo.jp/entry/2018/12/10/233146\">【Unity】Timelineからメソッドを呼ぶ新機能 「Marker」と「Signal、Signal Receiver」 - テラシュールブログ</a>\n<ul>\n<li>テラシュールブログさんによるSignalの解説ブログ</li>\n</ul>\n</li>\n<li><a href=\"https://speakerdeck.com/lycoris102/timeline-signals-tutorial\">[Unity] 分かった気になる! Timeline Signals / Timeline Signals Tutorial</a>\n<ul>\n<li>青木ととさんによるSignalの解説スライド</li>\n</ul>\n</li>\n</ul>","excerpt":"Unity 2019.1から、Timelineで任意のメソッドを呼び出すSignalsという仕組みが導入されました。\n開発中に、これスクリプトで追加したくなったので、その方法について記載します。 Signalsとは？ SignalsはTimelineから指定したフレームにTimeline外の特定の処理を行うための機能です。Animationについて知見のある方は、TimelineにおけるAnimationEvent…","fields":{"slug":"/2020/10/scripting-marker/"},"frontmatter":{"date":"October 05, 2020","type":null,"tags":["Unity","Timeline","Signal","エディタ拡張"],"title":"Timeline Signalsをスクリプトから追加する","description":null,"eyecatch":null}}},"pageContext":{"id":"4be0650f-f770-5ab4-a84b-9cb4b038ae3d"}},"staticQueryHashes":["1480509143","3159585216"]}