{"componentChunkName":"component---src-templates-post-tsx","path":"/2023/12/whywaita-advent-calendar-2023-mawaru-whywaita/","result":{"data":{"markdownRemark":{"html":"<p>これは <a href=\"https://adventar.org/calendars/8553\">whywaita Advent Calendar 2023</a> の21日目の記事です。</p>\n<p>whywaitaさんとは同じ会社に勤めていて、日頃からプライベートクラウドやself-hosted runner、最近ではポーカーを教えていただくなどお世話になっているので、日頃の感謝を込めてアドカレに記事を寄稿させていただいています。</p>\n<p>記事のネタ探しに悩んでいたところ、下記のように「気合でこじつければなんでも良いです」とのことだったので、18日目に「<a href=\"https://izacchi16.hatenablog.jp/entry/2023/12/18/201418\">Flutterアプリでwhywaitaアイコンを回してみた</a>」という記事が投稿されたので、<a href=\"https://learning.unity3d.jp/speaker/yuuichiro-mukai/\">Unityエンジニアの自分としては</a>Unityアプリでアイコンを回すことにします（？）。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 693px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d21009556c19501e28102e200c7409b1/61c63/image-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABOUlEQVQoz41S2W6DMBDk/5/zTZXaqEqk0hZxJBzhMoc5QgAbMtVumkZ5q6XRnp7ZtWxsNhu8bd+RJjGaRkLNM9Z1gdYKy3Kz67riv8fYvr7g69uCKCvItkMlG5S1RJoLFFXNlvKzXtCPCudJYZw1humBWWlM08TCBrGWVY0Py4MfC+TyjG5aGP0v2otCN2rIQaEZFMd3dKPCZZpx7ntorWEQ6zAMyNKEIesaIs+RZykKkaNtGs4VQqBtJNs0SbjWtS1EnnH/38rX6xVKKWRZhuPxiDAMYVkW9vs9TPMTSZLANE3sdjvYtsO+63pwHAdBECAMI47pvZ8IiSiKIgiaIE1RliWLUHw6ndhWVcW1mrYQgsXiOGbiJ0La3fd9HA4HeN5D3XVdhMFtYrpo2zb3kU895JMICdx/wg8iRhAm0LzGyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"社内Slackでの相談の様子\"\n        title=\"社内Slackでの相談の様子\"\n        src=\"/static/d21009556c19501e28102e200c7409b1/61c63/image-1.png\"\n        srcset=\"/static/d21009556c19501e28102e200c7409b1/772e8/image-1.png 200w,\n/static/d21009556c19501e28102e200c7409b1/e17e5/image-1.png 400w,\n/static/d21009556c19501e28102e200c7409b1/61c63/image-1.png 693w\"\n        sizes=\"(max-width: 693px) 100vw, 693px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>社内Slackでの相談の様子</p></figcaption>\n  </figure></p>\n<p>下図のように回るwhywaitaを実現できます。</p>\n<p><img src=\"/376ff87967a88f0f9cb7854791c2b99e/mawaru_whywaita.gif\" alt=\"回るwhywaita\"></p>\n<p>ちなみに回転以外の変換やそれらの変換の複数個の組み合わせもできます。</p>\n<p><img src=\"/d693089b2f7cb495769e203f6a0bd9f5/iroiro_whywaita.gif\" alt=\"いろいろなwhywaita\"></p>\n<p>本記事では、このようなアイコンを回すUnityアプリについて、その実装の1手法を紹介します。</p>\n<p>著者はUnity 2022.3.15f1にて検証を行いました。</p>\n<h2 id=\"シーンのセットアップ\" style=\"position:relative;\"><a href=\"#%E3%82%B7%E3%83%BC%E3%83%B3%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97\" aria-label=\"シーンのセットアップ permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>シーンのセットアップ</h2>\n<p>まず、アプリケーションのシーンについて簡単に説明します。</p>\n<p>whywaitaアイコンはメニューの_GameObject > 3D Object > Plane_ で作成したプリミティブを作成し、その正面がワールド座標の上を向くように配置しています。また、アイコン画像をテクスチャとしたマテリアルを貼り付けています。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a1ac0eace24631958714811b960824bb/a2792/image-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVklEQVQoz3WR227aQBBA/R9RbFKSSpVIA7XjvS+2MWDHJsBTHyq1r/3/HzjVLuGiSH040mhm5+zuTLJZeTa1whmB1zmyeEbkM2Q+Q/yYoYpnluaVpVN4Z2hqS92sqOqasixZLBYURRHRWpO8rxV7O+Gw/MrBP7J3U/Z2ytE/nWI35eCfIsf6G3+OinVtaJoW7z1CCKSUkSjcVd8Z5D2jmpzQE95URv+RG875WHvg3U6pvcI5jzGaPM+Zz+eRECehYdCnxkCQHewDv3cvjOYLn+ujSlmvPP14oN30WF+htcFZS9u2QZhxZtQZXXnHr+0Lf392bPKUnbnWT8IMpwuWVUPX9Wy3XRRVVRVHkAwq/TicXhp7mbLTWXzN5/qoU3Q557UUaB2+7rDWxlmGJSW3okFem99CLM/Cq3hU9xixQEh1kdwuJrncLv9HdiO+EQqFlFdRIIj/ATeeCnYCT4cUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"シーンセットアップ\"\n        title=\"シーンセットアップ\"\n        src=\"/static/a1ac0eace24631958714811b960824bb/5a190/image-2.png\"\n        srcset=\"/static/a1ac0eace24631958714811b960824bb/772e8/image-2.png 200w,\n/static/a1ac0eace24631958714811b960824bb/e17e5/image-2.png 400w,\n/static/a1ac0eace24631958714811b960824bb/5a190/image-2.png 800w,\n/static/a1ac0eace24631958714811b960824bb/c1b63/image-2.png 1200w,\n/static/a1ac0eace24631958714811b960824bb/a2792/image-2.png 1462w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>シーンセットアップ</p></figcaption>\n  </figure></p>\n<p>下図のように、そのPlaneを上から見下ろすかたちでカメラが配置されています。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/84c6c55aaa4823fa63661153cc42257f/bf433/image-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACDklEQVQoz21SwYrTUBTNypULRRkRTPKSMiI4tGMnbZOXJqZNMm3aJO3oNEtFFy5mIcxC3Ai6F93oogtR7E84In6EulDB+ZYj970ktoOBw30n997zzr08JQ6HmKVj5OMQ4TDAYDBEHHB4vIOe1YLT2YXdaaG315RnqyVyo9BHGMeIwgGG4wxxNMQoSaDs70eYOjpmfQOzvomc4BrIXYaMwBly10QR38A8NEpu1PWEzGF4cODg4YJDKYoFEpth6jBMHF3Es8i8bRyGTRRcL+s28xNbxd3oFhZRE8o8uY2JrSPlTDitQJyQuQZS10TCr9f/RA3fFE3Ly5RxV90QmjqabHSl2JTrGHWu4sA3kTqq4JSjun89lbAORSjzSkgvHUknE1vDzGvg6F6KUdBF3DORueUEteiaMGdQqGlaCgn0zdop7Sb3Gnj54jF22xZ4extzj3ao1ZNUZgQ4OXRZ7WrjRlvGpHsNqcNwGO4gFSJGXUd9M49ehoHcMwVX5JLXbJOQrSFdOxMqYZmTJqL2Ffg3LyBoXoK/cxGD1mUok3VH/4FYia1LOLrgJBY0t/DofoHV+yWWb19j+eYVnhwfkUNNjkIj0DOhhZMLaqTdnuWc4Y7fwB47h9WHd6Dv08lnEX/++g0lslRElobY0kSUUNfOFVdFTdzRMbYNtM3zeP7sKU5P/+DrlxP8+P4Nq9VH/AU1oaGVhQSZNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"カメラの配置\"\n        title=\"カメラの配置\"\n        src=\"/static/84c6c55aaa4823fa63661153cc42257f/5a190/image-3.png\"\n        srcset=\"/static/84c6c55aaa4823fa63661153cc42257f/772e8/image-3.png 200w,\n/static/84c6c55aaa4823fa63661153cc42257f/e17e5/image-3.png 400w,\n/static/84c6c55aaa4823fa63661153cc42257f/5a190/image-3.png 800w,\n/static/84c6c55aaa4823fa63661153cc42257f/bf433/image-3.png 971w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>カメラの配置</p></figcaption>\n  </figure></p>\n<h2 id=\"whywaitaを回すアニメーションするクラス\" style=\"position:relative;\"><a href=\"#whywaita%E3%82%92%E5%9B%9E%E3%81%99%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%99%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%B9\" aria-label=\"whywaitaを回すアニメーションするクラス permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>whywaitaを回す（アニメーションする）クラス</h2>\n<p>下記のようなクラスを用意し、上記のPlaneオブジェクトにアタッチしています。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token class-name\">Matrix4x4</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">UnityEngine<span class=\"token punctuation\">.</span>Matrix4x4</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token class-name\">Vector3</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">UnityEngine<span class=\"token punctuation\">.</span>Vector3</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">RequireComponent</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">MeshFilter</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WhywaitaAnimationPlayer</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehaviour</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Mesh</span> _mesh<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Vector3<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> _originalVertices<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">SerializeReference</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SubclassSelector</span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">IWhywaitaAnimation<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> _whywaitaAnimations<span class=\"token punctuation\">;</span>\n\n    <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        _mesh <span class=\"token operator\">=</span> <span class=\"token generic-method\"><span class=\"token function\">GetComponent</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>MeshFilter<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>mesh<span class=\"token punctuation\">;</span>\n\n        _originalVertices <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Vector3</span><span class=\"token punctuation\">[</span>_mesh<span class=\"token punctuation\">.</span>vertices<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        Array<span class=\"token punctuation\">.</span><span class=\"token function\">Copy</span><span class=\"token punctuation\">(</span>_mesh<span class=\"token punctuation\">.</span>vertices<span class=\"token punctuation\">,</span> _originalVertices<span class=\"token punctuation\">,</span> _mesh<span class=\"token punctuation\">.</span>vertices<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> time <span class=\"token operator\">=</span> Time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// メッシュの変形を表す行列</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> matrix <span class=\"token operator\">=</span> Matrix4x4<span class=\"token punctuation\">.</span>identity<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> animation <span class=\"token keyword\">in</span> _whywaitaAnimations<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>animation <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                matrix <span class=\"token operator\">*=</span> animation<span class=\"token punctuation\">.</span><span class=\"token function\">GetMatrix</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> vertices <span class=\"token operator\">=</span> _mesh<span class=\"token punctuation\">.</span>vertices<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> vertices<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 各頂点に変形を適用</span>\n            vertices<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> matrix<span class=\"token punctuation\">.</span><span class=\"token function\">MultiplyPoint3x4</span><span class=\"token punctuation\">(</span>_originalVertices<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        _mesh<span class=\"token punctuation\">.</span>vertices <span class=\"token operator\">=</span> vertices<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>このクラスは、毎フレームごとの経過時間に応じたメッシュの変換を行列として表して、<code>MeshFilter</code>クラスが持つメッシュの頂点に対して行列を乗算する形で変換を適用しています。</p>\n<p>コード中の <code>IWhywaitaAnimation</code> は下記のようなインターフェイスです。\nこのインターフェイスを実装する1つのクラスが1つの変換をあらわす形で実装されます。<code>GetMatrix(float time)</code> で、時間 <code>time</code> における変換を表す行列が取得できるといった形です。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IWhywaitaAnimation</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token return-type class-name\">Matrix4x4</span> <span class=\"token function\">GetMatrix</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">float</span></span> time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>たとえば「一定の速度で回転する変換を表すクラス」は下記コードで実装できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Serializable</span></span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WhywaitaAnimationRotation</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">IWhywaitaAnimation</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// 回転速度この値が1.0で1秒で1回転とする</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token punctuation\">[</span>SerializeField<span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> _speed<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// 回転軸</span>\n    <span class=\"token comment\">/// &lt;/summary>   </span>\n    <span class=\"token punctuation\">[</span>SerializeField<span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token class-name\">Vector3</span> _axis<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">Matrix4x4</span> <span class=\"token function\">GetMatrix</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">float</span></span> time<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Matrix4x4<span class=\"token punctuation\">.</span><span class=\"token function\">Rotate</span><span class=\"token punctuation\">(</span>\n            Quaternion<span class=\"token punctuation\">.</span><span class=\"token function\">AngleAxis</span><span class=\"token punctuation\">(</span>\n                _speed <span class=\"token operator\">*</span> time <span class=\"token operator\">*</span> <span class=\"token number\">360f</span><span class=\"token punctuation\">,</span>\n               _axis \n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>一番初めに示したwhywaitaアイコンの単純な回転は、 <code>WhywaitaAnimationPlayer</code> の <code>_whywaitaAnimations</code> を下図インスペクター画像のように設定することで実現できます。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/260a19f487ec2d1532e2c71f5c983a25/ff42b/image-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVQoz12QWW7DMAxEdZggX15ix4C3xPIiL/WSxEbr3v8kUwxTGUU/HkiOqKFENc4fyHUPM3+jGlbUw4pm+pJoxs/fekdRdUiTBFmWCWmaCkmSoG1bdF2HsiyhWGitD4qiQJ7n0qxLjfv9jizLRbNmzGl0vV6FMAzhOA6iKIJ6Pp8g8zxLnKYJdV3LtLY1GIYBfd8LzC2sjTHyOvbTTAwprOuKfd/F0DYxjuOIbdvk/PF44PV6SaS2LAuqqhKappEv845iwkYaciprC5td18X5fBYulws8zztq3/cRBIHkp9NJetX7a+8XMbdwn9S4L7sn7vd2ux0198uhVo/jGIoTOJkw/4vVeJlY/X/NB9CQO/wBzwXxUO8VSWQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"「回るwhywaita」のためのインスペクターの設定\"\n        title=\"「回るwhywaita」のためのインスペクターの設定\"\n        src=\"/static/260a19f487ec2d1532e2c71f5c983a25/ff42b/image-4.png\"\n        srcset=\"/static/260a19f487ec2d1532e2c71f5c983a25/772e8/image-4.png 200w,\n/static/260a19f487ec2d1532e2c71f5c983a25/e17e5/image-4.png 400w,\n/static/260a19f487ec2d1532e2c71f5c983a25/ff42b/image-4.png 484w\"\n        sizes=\"(max-width: 484px) 100vw, 484px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>「回るwhywaita」のためのインスペクターの設定</p></figcaption>\n  </figure></p>\n<p>ちなみ大量の頂点が存在する場合には、このような頂点の変換が伴う実装はCPU側（C#スクリプト上）ではなくGPU側（シェーダー側）で行うのが良いですが、今回はデモというかわかりやすさを意識してこの方式にしています。</p>\n<h2 id=\"アフィン変換\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%95%E3%82%A3%E3%83%B3%E5%A4%89%E6%8F%9B\" aria-label=\"アフィン変換 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アフィン変換</h2>\n<p>今回のデモを作成するにあたって、<code>IWhywaitaAnimation</code>には、ある時刻における頂点を回転や拡大・縮小などの線形変換と平行移動をあらわす行列を返すクラスを実装しました。</p>\n<p>これらの「回転」や「拡大縮小」、平行移動などはアフィン変換と呼ばれます。</p>\n<p>アフィン変換の良いところは、2つめのデモのように複数の変換を組み合わせたい場合に、変換を掛けたい順に行列を掛け合わると、複数の変換をまとめた行列が作成できる点です。\n<code>WhywaitaAnimationPlayer</code>の下記部分が、複数の変換を組み合わせる実装になります。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">        <span class=\"token comment\">// メッシュの変形を表す行列</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> matrix <span class=\"token operator\">=</span> Matrix4x4<span class=\"token punctuation\">.</span>identity<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> animation <span class=\"token keyword\">in</span> _whywaitaAnimations<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>animation <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// ここでアフィン変換を表す行列をかけ合わせている</span>\n                matrix <span class=\"token operator\">*=</span> animation<span class=\"token punctuation\">.</span><span class=\"token function\">GetMatrix</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>たとえば下図のように、回転したあとにそのアイコンのz方向（下方向）に平行移動を行うような変換を定義すると、</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 482px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6de698bac9ecf56c274b457f76b0984/37e0d/image-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA70lEQVQY03WRWaqGMAyFXYyiOM8444AK4oSKw/4Xkp8TUO7LffhIm5OmJ63Q9z01TcO0bcsxjmOKoojCMCTXdf/F87wPTdMYIUkSquuamyGiEQps26aqqmjbNlrX9WNZFs7N8/wZAThbFAUJuq4TmqJhEARkGAZZlkWmabJDaLgEvM7f+Neh7/uMgIMoSNOUGzmOw8AhCqFLksSoqkowgLUoirxGnaIoJMsy6wLsvmMMw8DWkSvLkqZpovu+6TgO2vedruviiP3L8zxc13UdTylggQSE8zxZeMVxHCnP8+8J8Kbg3WdZRvhUfBDcYrIfuarMfKNteLYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"そと回りを行う変換\"\n        title=\"そと回りを行う変換\"\n        src=\"/static/f6de698bac9ecf56c274b457f76b0984/37e0d/image-5.png\"\n        srcset=\"/static/f6de698bac9ecf56c274b457f76b0984/772e8/image-5.png 200w,\n/static/f6de698bac9ecf56c274b457f76b0984/e17e5/image-5.png 400w,\n/static/f6de698bac9ecf56c274b457f76b0984/37e0d/image-5.png 482w\"\n        sizes=\"(max-width: 482px) 100vw, 482px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>そと回りを行う変換</p></figcaption>\n  </figure></p>\n<p>下図のようなアニメーションになります。ちゃんと、回転してから平行移動したようなアニメーションになっていることが確認できました。</p>\n<p><img src=\"/13f76915c8fdf982b40317caa008b407/sotoni_mawaru_whywaita.gif\" alt=\"そと回りの実際のアニメーション\"></p>\n<h2 id=\"余談-serializereferencedropdown\" style=\"position:relative;\"><a href=\"#%E4%BD%99%E8%AB%87-serializereferencedropdown\" aria-label=\"余談 serializereferencedropdown permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>余談: SerializeReferenceDropdown</h2>\n<p>今回、<code>IWhywaitaAnimation</code> のシリアライズのために<a href=\"https://github.com/AlexeyTaranov/SerializeReferenceDropdown\">SerializeReferenceDropdown</a>を利用しました。</p>\n<p><a href=\"https://github.com/AlexeyTaranov/SerializeReferenceDropdown\">AlexeyTaranov/SerializeReferenceDropdown: (Unity) Editor dropdown for SerializeReference Attribute with Copy/Paste</a></p>\n<p>Unity 2019.3以降に <code>SerializeReference</code> が実装されたことで、インターフェイスや抽象クラスの参照がシリアライズできるようになりましたが、あくまでも参照のシリアライズにとどまるので、これ単体では微妙に使い勝手が悪いです。</p>\n<p><code>SerializeReferenceDropdown</code> を用いることで、内部でそのインターフェイス・基底クラスを実装するサブクラスのインスタンスを作成し、そのインスタンスの参照を設定するようなドロップダウンメニューをインスペクター上に生成できます。</p>\n<p>便利なので入れておくと何かとはかどるかもしれません。ちなみに類似ライブラリとして下記のようなものあります。</p>\n<ul>\n<li><a href=\"https://github.com/mackysoft/Unity-SerializeReferenceExtensions\">mackysoft/Unity-SerializeReferenceExtensions: Provide popup to specify the type of the field serialized by the [SerializeReference] attribute in the inspector.</a></li>\n<li><a href=\"https://github.com/CareBoo/Serially\">CareBoo/Serially: Adds a unity-supported, SerializableType class and an inspector for editing SerializeReference fields.</a></li>\n</ul>\n<h2 id=\"おわりに\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\" aria-label=\"おわりに permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おわりに</h2>\n<p>whywaitaアイコンを回すUnityアプリの実装と、その中身について簡単に解説しました。\nwhywaita Advent Calendarは例年インフラ要素が多めだと思いますが、Unityという新たなジャンルを開拓できたので良かったのではと思います（？）。</p>\n<p>明日はkyontanさんの記事です。</p>","excerpt":"これは whywaita Advent Calendar 2023 の21日目の記事です。 whywaitaさんとは同じ会社に勤めていて、日頃からプライベートクラウドやself-hosted runner、最近ではポーカーを教えていただくなどお世話になっているので、日頃の感謝を込めてアドカレに記事を寄稿させていただいています。 記事のネタ探しに悩んでいたところ、下記のように「気合でこじつければなんでも良いです」とのことだったので、18日目に「Flutterアプリでwhywaita…","fields":{"slug":"/2023/12/whywaita-advent-calendar-2023-mawaru-whywaita/"},"frontmatter":{"date":"December 21, 2023","type":"tech","tags":["Unity","whywaita","Advent Calendar 2023"],"title":"Unityアプリでwhywaitaのアイコンを回す","description":"whywaita Advent Calendar 2023の21日目の記事として、Unityアプリでwhywaitaのアイコンを回すアプリの実装を紹介しています。","eyecatch":null}}},"pageContext":{"id":"048013f5-6041-5559-8cb4-9b83cbb15a34"}},"staticQueryHashes":["1480509143","3159585216"]}