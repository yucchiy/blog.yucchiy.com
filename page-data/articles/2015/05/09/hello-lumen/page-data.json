{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2015/05/09/hello-lumen/","result":{"data":{"markdownRemark":{"html":"<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0220c6bfec888585eabf57144c803119/5b2ff/hello-lumen.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB30lEQVQoz0XLyW8SURwAYP5bh1lYKliFCsPSYVimQJDQYhnFFlsIStiGZYbiwcaYePTszXNh3nuzvN9rYqgxfvcvwFSJVUKsHmbNCLQjoEehe0R7cdpP+KOUP5H9acqbptxZ2jEyZJkjK4WYJWxp6K4WYKrINInVQ6wpQTsMegQ+ROnNMR2lfUP1V2VvoXhGxp2nyd+8VohZRJaGtv+zBE0JLkLQCdHuER0k6VKDrzq9f+d/aXpLxZvLTzlL1qfYLOKNhrbVAFN5VhFZXTzk8xB0JNqN0GGKWm8ef31//P2T3ndcs+jM0sSQyTKLD1lFm4p9Vw2wAs8qAtQEaApwIdJLkb4P09tX1CjBtyv40fe3DXeRP+S5jA85j0wVWf8ylHmo8dAQ6LlA3wpUF73r52SQxBMFGRVkqM7ktTM5wbM0WmTwKo/WBdsqP2UlCKUgnHG0wdMWT9uCrwteVyK9GOkfk2ECf046owQZJ/E0hQwZLfP2WrXN8n5TDcApB0UONI7Wg35L9Nqi25HcbsS9jjgfo6Qfw8MXeJRA45Q9lffzrL3I7VeF3bq8s84CkH8GKgcVjtY4vyW5l1FHj5KrGOnF8U0cD16iTyf2KL0fy7tpbjfP7+e53UJ9WJUfzOofOwl8tmMnQzoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hello-lumen\"\n        title=\"hello-lumen\"\n        src=\"/static/0220c6bfec888585eabf57144c803119/5a190/hello-lumen.png\"\n        srcset=\"/static/0220c6bfec888585eabf57144c803119/772e8/hello-lumen.png 200w,\n/static/0220c6bfec888585eabf57144c803119/e17e5/hello-lumen.png 400w,\n/static/0220c6bfec888585eabf57144c803119/5a190/hello-lumen.png 800w,\n/static/0220c6bfec888585eabf57144c803119/c1b63/hello-lumen.png 1200w,\n/static/0220c6bfec888585eabf57144c803119/29007/hello-lumen.png 1600w,\n/static/0220c6bfec888585eabf57144c803119/5b2ff/hello-lumen.png 2190w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>hello-lumen</p></figcaption>\n  </figure></p>\n<p>4月の中旬にLaravel5ベースなマイクロフレームワークである<a href=\"https://github.com/laravel/lumen\">Lumen</a>がリリースされた.\nLumenは, Laravel5から <strong>ウェブフレームワークとして動作するために必要な機能のみを残した</strong> 感じのフレームワークだが,\nLaravel5のServiceProviderとして提供されているライブラリはほとんどそのまま利用できるため, <strong>Laravel5の資産を使いまわせる仕組みになっている</strong>.\nまた, 開発規模が大きくなった場合でも, <strong><code>app</code>ディレクトリ等をほぼそのままインポートすることでLaravel5にのせかえることができる</strong> ため,\nとりあえずミニマムにLumenでプロジェクトをスタートさせて, 大きくなったらLaravel5にのせかえる, なんてことも容易にできる.</p>\n<h2 id=\"ディレクトリ構成と設定\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90%E3%81%A8%E8%A8%AD%E5%AE%9A\" aria-label=\"ディレクトリ構成と設定 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ディレクトリ構成と設定</h2>\n<p>実際にディレクトリ構造を見ていく. まずはLaravel5のディレクトリ構造.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% tree -L 1 -d\n.\n├── app\n├── bootstrap\n├── config\n├── database\n├── public\n├── resources\n├── storage\n├── tests\n└── vendor\n\n9 directories</code></pre></div>\n<p>次にLumenのディレクトリ構造.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% tree -L 1 -d\n.\n├── app\n├── bootstrap\n├── database\n├── public\n├── resources\n├── storage\n├── tests\n└── vendor\n\n8 directories</code></pre></div>\n<p>Lumenでは, 基本的にはプロジェクトルート以下置いた<code>.env</code>を用いて設定を行うことが<a href=\"http://lumen.laravel.com/docs/configuration#configuration-files\">推奨されている</a>ため, <code>config</code>ディレクトリがデフォルトで存在しない.\nLumenのインストール時に, <code>.env.example</code>がサンプルファイルとして用意されており, これをリネームして利用すればよい.\nただし, 1点嵌りポイントとして, <strong>デフォルトで<code>.env</code>を読み込む設定になっていない</strong>. <code>.env</code>を読み込むようにするには<code>bootstrap/app.php</code>の以下のコメントアウトを外す必要がある.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;?php\n\nrequire_once __DIR__.'/../vendor/autoload.php';\n\nDotenv::load(__DIR__.'/../'); // ここのコメントを外す</code></pre></div>\n<p><code>.env</code>による設定を推奨しているが, もう少し柔軟に設定したいとか, 外部パッケージを導入したときの設定を書く必要があるときがある.\nそういうときは, 今までどおりプロジェクトルートに<code>config</code>ディレクトリを作成して, そこの設定ファイルをおいて, <code>$app->configure('hoge')</code>を書くことで読み込まれる.\nデフォルトの設定は<code>vendor/laravel/lumen-framework/config</code>にあるので, これをコピーすれば良い.</p>\n<p>ここで<code>bootstrap/app.php</code>について触れるついでに追記しておくと, LumenではLaravel5でお馴染みのEloquentやFacadeが利用できるが, デフォルトではロードされていない.\nこれらを利用するには, <code>bootstrap/app.php</code>内の以下のコメントを外せば良い.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// $app->withFacades();\n\n// $app->withEloquent();</code></pre></div>\n<p>また, デフォルトではセッションやCSRF関係の設定も無効になっている. これらはLumenではミドルウェアを差し込むことによって設定を有効にできる.\n例えばセッションを有効にするには, 以下の<code>StartSession</code>のコメントを外せば良い.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// 必要に応じてコメントを外す\n\n// $app->middleware([\n//     // 'Illuminate\\Cookie\\Middleware\\EncryptCookies',\n//     // 'Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse',\n//     // 'Illuminate\\Session\\Middleware\\StartSession',\n//     // 'Illuminate\\View\\Middleware\\ShareErrorsFromSession',\n//     // 'Laravel\\Lumen\\Http\\Middleware\\VerifyCsrfToken',\n// ]);</code></pre></div>\n<p>Sessionは<a href=\"http://lumen.laravel.com/docs/responses#redirects\">Redirects</a>や<a href=\"http://lumen.laravel.com/docs/requests#old-input\">Old Input</a>, 認証を書くときなどアプリケーションでよく使うものなので特に理由がなければ有効にしておけば良い.</p>\n<p>次に<code>app</code>内のディレクトリ構成について見ていく. こちらはLaravel5.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% tree app -d\napp\n├── Commands\n├── Console\n│   └── Commands\n├── Events\n├── Exceptions\n├── Handlers\n│   ├── Commands\n│   └── Events\n├── Http\n│   ├── Controllers\n│   │   └── Auth\n│   ├── Middleware\n│   └── Requests\n├── Providers\n└── Services\n\n15 directories</code></pre></div>\n<p>こちらはLumen.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% tree app -d\napp\n├── Console\n│   └── Commands\n├── Exceptions\n├── Http\n│   ├── Controllers\n│   └── Middleware\n├── Jobs\n└── Providers\n\n8 directorie</code></pre></div>\n<p>全体的にシュッっとしている. <code>Jobs</code>ディレクトリだけ見慣れないけど, 多分<code>Command</code>とかのかわりになる気がする.\n必要になったら自分で好きにディレクトリ構造を足していくという感じで, ミニマムに保たれているという感じがする.</p>\n<h2 id=\"使ってみる\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"使ってみる permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使ってみる</h2>\n<p>Lumenでは, PHPのビルドインサーバーがサポートされているため, apache+mod_phpやphp-fpmなどを利用しなくても, <code>artisan serve</code>だけで簡単にサーバーを立ち上げることができる.\n開発時はビルドインサーバーでやって, 本番ではapacheやnginx + php-fpmみたいな構成にしてやればよい.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% composer global require \"laravel/lumen-installer=~1.0\"\n% lumen new lumen-project\n% cd lumen-project\n% php artisan serve</code></pre></div>\n<p>先ほど紹介したように<code>.env</code>により設定を行う.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% cp .env.example .env\n% vim bootstrap/app.php\n&lt;?php\n\nrequire_once __DIR__.'/../vendor/autoload.php';\n\nDotenv::load(__DIR__.'/../'); // ここのコメントを外す</code></pre></div>\n<p>Lumenではデフォルトで本番環境用の設定となる. 具体的にはデバッグモードが無効になっており, エラーメッセージが出ない.\nそのため, 開発時は<code>.env</code>内の<code>APP_DEBUG</code>を<code>true</code>にしておく方が何かと便利だと思う.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% cat .env\nAPP_ENV=local\nAPP_DEBUG=true\nAPP_KEY=SomeRandomString\n\nDB_HOST=localhost\nDB_DATABASE=homestead\nDB_USERNAME=homestead\nDB_PASSWORD=secret\n\nCACHE_DRIVER=file\nSESSION_DRIVER=file\nQUEUE_DRIVER=sync\n\nMAIL_DRIVER=smtp\nMAIL_HOST=mailtrap.io\nMAIL_PORT=2525\nMAIL_USERNAME=null\nMAIL_PASSWORD=null</code></pre></div>\n<p>設定ができたら, <code>app/routes.php</code>でルーティングを設定して開発していく. 基本はLaravel5と一緒で, 使ったことある人は違和感なく開発ができると思う.\nコントローラは, <code>App\\Http\\Controllers\\Controller</code>を継承するようにする. ビューはLaravel5と同様にbladeテンプレートが利用できる. 使い方も特に変わらない.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">% cat app/routes.php\n&lt;?php\n\n$app->get('/', ['uses' => '\\App\\Http\\Controllers\\WelcomeController@index']);\n% cat app/Http/Controllers/WelcomeController.php\n&lt;?php namespace App\\Http\\Controllers;\n\nclass WelcomeController extends Controller {\n    public function index()\n    {\n        return view('welcome_index');\n    }\n}\n% cat resources/views/welcome_index.blade.php\n&lt;h1>Hello Lumen&lt;/h1></code></pre></div>\n<p>ミニマムだなと感じたのは, ルーティングでは<a href=\"https://github.com/laravel/lumen-framework/issues/85\">グループがネスト出来なかったり</a>,\n<code>$router->controller(s)</code>がなかったりする点である.</p>\n<blockquote>\n<p>Lumen's routing is intentionally simpler so that performance is maximal. I don't think nested groups are supported.</p>\n</blockquote>\n<p>上のIssueに上がっているように, <strong>Lumen自体は小さく・パフォーマンスを重視をコンセプト</strong> にしていて, それ以外は個人でよろしくやってくれってスタンスが感じられる.</p>","excerpt":"4月の中旬にLaravel5ベースなマイクロフレームワークであるLumenがリリースされた.\nLumenは, Laravel5から ウェブフレームワークとして動作するために必要な機能のみを残した 感じのフレームワークだが,\nLaravel5のServiceProviderとして提供されているライブラリはほとんどそのまま利用できるため, Laravel5の資産を使いまわせる仕組みになっている.\nまた, 開発規模が大きくなった場合でも, app…","fields":{"slug":"/articles/2015/05/09/hello-lumen/"},"frontmatter":{"date":"May 09, 2015","type":null,"tags":["php","Lumen","Laravel"],"title":"Lumenを触った所感","description":"LumenというLaravel5ベースなマイクロフレームワークがリリースされたので, 使ってみた所感といくつかハマりそうなポイントを備忘録がわりにメモ.","eyecatch":null}}},"pageContext":{"id":"cd2fc5f7-cde2-5bd6-a123-3fa52b490551"}},"staticQueryHashes":["1480509143","3159585216"]}