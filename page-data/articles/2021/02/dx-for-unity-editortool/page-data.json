{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2021/02/dx-for-unity-editortool/","result":{"data":{"markdownRemark":{"html":"<p>Unityでツールを実装するとき、個人的に気をつけていることと、それを実現するためのAPIについて紹介します。</p>\n<h2 id=\"使いやすいツールとは\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E3%81%84%E3%82%84%E3%81%99%E3%81%84%E3%83%84%E3%83%BC%E3%83%AB%E3%81%A8%E3%81%AF\" aria-label=\"使いやすいツールとは permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使いやすいツールとは</h2>\n<p>Unityにおいてツールを作る目的は、主にゲームを作るときの効率化であることが多いと思います。</p>\n<p>ツールはプログラマだけではなく、デザイナーさんやプランナーさんなど、様々な方が使うことが想定されます。\nそのため<strong>プログラマ以外の方たちにも使いやすいツール</strong>であることが望ましいです。</p>\n<p>ツールを実行している際に、何を実行しているかわからなかったり、その状態で長い間なにも反応がないと、\n使い手は「正常にツールが実行されているのだろうか？」と不安になると思います。</p>\n<p>そこでツールを実装する際に、下記のことを気をつけています。</p>\n<ul>\n<li>何をやってるかがわかる</li>\n<li>あとどのぐらいで終わるかがわかる</li>\n<li>なにが起こったかがわかる</li>\n</ul>\n<p>要には不安を解消できるよう、<strong>適切に情報を提供する</strong>ように心がけています。</p>\n<h2 id=\"editorutilityを用いる\" style=\"position:relative;\"><a href=\"#editorutility%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B\" aria-label=\"editorutilityを用いる permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EditorUtilityを用いる</h2>\n<p>上記を解消するのに <a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.html\"><code>EditorUtility</code></a>というAPIが便利です。</p>\n<h3 id=\"進捗を表示する\" style=\"position:relative;\"><a href=\"#%E9%80%B2%E6%8D%97%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\" aria-label=\"進捗を表示する permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>進捗を表示する</h3>\n<p>「一括でデータを変換したい」または「重たい処理が処理が複数からなる」場合、ユーザーはその処理がどれだけ時間が必要なのか知りたくなります。\nその場合はプログレスバーなので進捗を表示するのが親切です。</p>\n<p><code>EditorUtility</code>の<a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.DisplayProgressBar.html\"><code>DisplayProgressBar</code></a>というメソッドを用いると簡単にプログレスバーを表示できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> total <span class=\"token operator\">=</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> total<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// プログレスバー描画</span>\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayProgressBar</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token interpolation-string\"><span class=\"token string\">$\"重たい処理の</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\"><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">番目を実行しています\"</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>i <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ここで処理を行う</span>\n    <span class=\"token function\">DoProcess</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// プログレスバーのクリア</span>\nEditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">ClearProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上記の実装で下図のようなプログレスバーが表示されます。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 423px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1180ae7af2e5b76ef1cf14dffabedcd5/f687d/displayprogressbar.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAw0lEQVQY02XP3U6DQBRFYd7/eYypPkFJtCZNoSkK5bfAMGdkwHJlZhkmTYz24ss6l2cHyyQsVtxifX9NwtVqVFOguwrpa67jwGwNxtxxt34Hj4fZPcczq6cbf0eryXcTTWwOloe9ZZcZRCt6pVB/uWEYCMLjxb2cWrZRRXhsCOOabVz7e/fe85p0vKUDUTmyL0bOF4MRjdZ3nIgQ1EVGXWQuTxOqPKXMU84fiW/f1nRNiaiWL2uYR8F+CvJvsoj479bJP3Q5Jn9ikRyDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DisplayProgressBarで表示されるプログレスバー\"\n        title=\"DisplayProgressBarで表示されるプログレスバー\"\n        src=\"/static/1180ae7af2e5b76ef1cf14dffabedcd5/f687d/displayprogressbar.png\"\n        srcset=\"/static/1180ae7af2e5b76ef1cf14dffabedcd5/772e8/displayprogressbar.png 200w,\n/static/1180ae7af2e5b76ef1cf14dffabedcd5/e17e5/displayprogressbar.png 400w,\n/static/1180ae7af2e5b76ef1cf14dffabedcd5/f687d/displayprogressbar.png 423w\"\n        sizes=\"(max-width: 423px) 100vw, 423px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>DisplayProgressBarで表示されるプログレスバー</p></figcaption>\n  </figure></p>\n<p><code>DisplayProgressBar</code>の第１引数にウインドウのタイトルを、第２引数にメッセージを表示します。第３引数には進捗を0.0 ~ 1.0で渡します。だいたい、<code>処理済みのタスク数 / タスク総数</code>を渡せばOKです。</p>\n<p>ただし１つ注意点として、処理の最後に<a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.ClearProgressBar.html\">EditorUtility.ClearProgressBar</a>を<strong>必ず呼ぶ必要があります</strong>。呼ばないとツールが終了した後もプログレスバーが残り続け、エディタのUIをロックしてしまいます。</p>\n<p>そこで処理の途中で例外が発生しても確実に<code>ClearProgressBar</code>を呼べるように、処理全体を<code>try</code>句で囲った上で、<code>finally</code>句の中でこのメソッドを呼ぶと楽です。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">try</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> total <span class=\"token operator\">=</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> total<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// プログレスバー描画</span>\n        EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayProgressBar</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token interpolation-string\"><span class=\"token string\">$\"重たい処理の</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\"><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">番目を実行しています\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>i <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// ここで処理を行う</span>\n        <span class=\"token function\">DoProcess</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Exception</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    UnityEngine<span class=\"token punctuation\">.</span>Debug<span class=\"token punctuation\">.</span><span class=\"token function\">LogException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">finally</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// DoProcessメソッド内で例外などを吐いても</span>\n    <span class=\"token comment\">// Unityが落ちない限りはこの処理を通る</span>\n\n    <span class=\"token comment\">// 確実にプログレスバーをクリアするようにする</span>\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">ClearProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>また、途中で処理を中断することをサポートできる場合は、<a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.DisplayCancelableProgressBar.html\">EditorUtility.DisplayCancelableProgressBar</a>を利用するとより親切です。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">try</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> total <span class=\"token operator\">=</span> <span class=\"token number\">10000000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> total<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// プログレスバー描画</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayCancelableProgressBar</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token interpolation-string\"><span class=\"token string\">$\"重たい処理の</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\"><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">番目を実行しています\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>i <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 処理が途中でキャンセルされるとこちらにはいる</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// ここで処理を行う</span>\n        <span class=\"token function\">DoProcess</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Exception</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    UnityEngine<span class=\"token punctuation\">.</span>Debug<span class=\"token punctuation\">.</span><span class=\"token function\">LogException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">finally</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 確実にプログレスバーをクリアするようにする</span>\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">ClearProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"ダイアログを表示する\" style=\"position:relative;\"><a href=\"#%E3%83%80%E3%82%A4%E3%82%A2%E3%83%AD%E3%82%B0%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\" aria-label=\"ダイアログを表示する permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ダイアログを表示する</h2>\n<p>処理が終わった後そのままツールを終了すると、ユーザーはそれが正常に終わったのか、それともどこか途中で処理が失敗したのかわかりません。</p>\n<p><code>Debug.Log</code>でコンソールにログを出力するでも良いのですが、他のログによって該当ログが発見しづらかったり、\nそもそも、コンソールログがプログラマ以外にあまり馴染みがなかったりと、ツールを使うユーザーへの通知としては不適切に感じています。\n(もちろんエラーログを吐いておくことで、何かエラーが発生した際にエディターログを送ってもらうことで、トラブルシューティングに役立ちます。)</p>\n<p>ユーザーへの通知を行うときにはダイアログを表示するのが便利です。<code>EditorUtility</code>には<a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.DisplayDialog.html\">EditorUtility.DisplayDialog</a>というメソッドが用意されています。\n例えば先程のツールでは下記のようにダイアログを表示すると、ユーザーにとってツールの状態がわかりやすくなるかと思います。</p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">try</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> total <span class=\"token operator\">=</span> <span class=\"token number\">10000000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> total<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// プログレスバー描画</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayCancelableProgressBar</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token interpolation-string\"><span class=\"token string\">$\"重たい処理の</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\"><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">番目を実行しています\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>i <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 処理が途中でキャンセルされるとこちらにはいる</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// ここで処理を行う</span>\n        <span class=\"token function\">DoProcess</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayDialog</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span> \n        <span class=\"token string\">\"処理がすべて正常に終わりました。\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">TestToolException</span> knownException<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// DoProcess中のエラー処理のうち、</span>\n    <span class=\"token comment\">// その後処理を継続できない場合は</span>\n    <span class=\"token comment\">// ユーザー定義の例外を吐いてそれをキャッチするとエラー処理が楽。</span>\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayDialog</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token interpolation-string\"><span class=\"token string\">$\"エラーが発生しました。</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">knownException<span class=\"token punctuation\">.</span>Message</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">,</span> \n        <span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Exception</span> exception<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// それ以外の予期しない例外の場合は、</span>\n    <span class=\"token comment\">// 素直にコンソールログに情報を吐き出しておき</span>\n    <span class=\"token comment\">// トラブルシューティングのためにプログラマに</span>\n    <span class=\"token comment\">// 問い合わせてくれというメッセージを書いておくと良いかも</span>\n    UnityEngine<span class=\"token punctuation\">.</span>Debug<span class=\"token punctuation\">.</span><span class=\"token function\">LogException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">DisplayDialog</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"テストツール\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"予期しないエラーが発生しました。\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">finally</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 確実にプログレスバーをクリアするようにする</span>\n    EditorUtility<span class=\"token punctuation\">.</span><span class=\"token function\">ClearProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 260px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/03068736fdfb7e8a208d918423a84d88/86c28/displaydialog.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACvUlEQVQ4y31STU8TURSdmogmhHTJgh0kxtYdLoi68A/4O2TFLxAUpjEmmhgQNsS4RvkwUEBoqaFfIIU60I+Zdt57My0t9JNEFyVh4xwzr9M6reLi5p737j1nzp37BMqozjQGqrFflFGDMgp+tnKhWOBRPCvy0HM67D0mh2nMsM4/BUIJCCWGlUEYaRNkRYbP78O2bxura6vwer2QjiVousZ72hybhsBdUS5iUNp0aBZOC6fYDe7C7XZjcHAQIyMj6Ovrw/z8PErlElSiglgOOc/SMB0aLeukeckFzTF3AjsYHh7G2NgYRFFEf38/Zt7NoFwpW4JNdxafY6H7wi7o9/vhcrkwOvoUz8bH4XQ6MT0zjXL1P4KUdv6Lboe9vb1wOBwYGBiAIAiYnZtFqVJG1hK08038T4etpaTlNDa/bGJ9Yx3Ly8t8MR1L6eJcOzLVGMcmsVKtoFqron5RR61e48+G92n0mpFt67dj02EqncLG5ga2trew8nkF3nUvEskEr9nF7HyB8rf35wtmcy6faz/g6F4UoXAI4UgYga8BKBmF17Wc3hRuidpHVilFllAQTUMsHocvEMBuKIRgOIJgJIJgOIxwNIpQJIqj7xLCe3vYj8UQlySojCFr8vlyaHPkYl7FeS6LUl6FriaQkr5BTcehnMSQSR4hkziEfHwAJXEIPZvgNSJL0NUkzi3uWV4F00yHKjHm1goYXygbkx9LmFqswLNSh7hUhbhU43lqsYrnn1q4YtWa2ORMLJTxeukMKZlCOD4hxpDnCg4Rxm0RuCUCPVNAj4VvvAAevgcef7BqYmc2OTc9MJwTv7CzzwxBUQievL0whiYvcc/TgEvsjLtiA/dfNfDozd81M9xiA3fESzx4+cM4kCgExkg1myVIp4mRlgnMkBWKNpYJkmmCkxRp33X3mNxMhoAxcvUbCx0YynykxHoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DisplayDialogで表示されるダイアログ。OS標準のUIが呼び出される。\"\n        title=\"DisplayDialogで表示されるダイアログ。OS標準のUIが呼び出される。\"\n        src=\"/static/03068736fdfb7e8a208d918423a84d88/86c28/displaydialog.png\"\n        srcset=\"/static/03068736fdfb7e8a208d918423a84d88/772e8/displaydialog.png 200w,\n/static/03068736fdfb7e8a208d918423a84d88/86c28/displaydialog.png 260w\"\n        sizes=\"(max-width: 260px) 100vw, 260px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>DisplayDialogで表示されるダイアログ。OS標準のUIが呼び出される。</p></figcaption>\n  </figure></p>\n<p>１点注意点として<code>DisplayDialog</code>はそれを呼び出した時点でその行で停止し、\nユーザーがダイアログに反応しないと次の処理を実行しません。</p>\n<p>一括で処理を行うようなツールの場合に途中で<code>DisplayDialog</code>を呼び出すと処理を止めてしまうことに注意しましょう。\nその場合は、結果をとりあえずリスト溜め込んでおき、すべての処理が終了後に結果を確認できるウインドウを表示すると親切です。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>個人的にツール作りにおいて、特にプログラマ以外のことが利用すること想定して大事にしていることと、\nそれを実現するために便利な<code>EditorUtility</code>のAPIを紹介しました。</p>\n<p>余談ですが<code>EditorUtility</code>には他にも、ファイル読み込みや保存の際に、\nそのファイルパスを選択させる<a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.OpenFilePanel.html\">EditorUtility.OpenFilePanel</a>や\n<a href=\"https://docs.unity3d.com/ScriptReference/EditorUtility.SaveFilePanel.html\">EditorUtility.SaveFilePanel</a>など便利なAPIがたくさんあります。</p>\n<p>ツール実装を行う際に、一度API一覧を軽く目を通すと良いかもしれません。</p>","excerpt":"Unityでツールを実装するとき、個人的に気をつけていることと、それを実現するためのAPIについて紹介します。 使いやすいツールとは Unity…","fields":{"slug":"/articles/2021/02/dx-for-unity-editortool/"},"frontmatter":{"date":"February 05, 2021","type":null,"tags":["Unity","UnityEditor","EditorUtility"],"title":"Unityでツールを作るときに個人的に気をつけていること。またはEditorUtilityについて。","description":null,"eyecatch":null}}},"pageContext":{"id":"2fa4851c-4016-52e3-a977-291b6785fdc5"}},"staticQueryHashes":["1480509143","3159585216"]}