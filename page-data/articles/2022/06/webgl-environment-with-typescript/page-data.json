{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2022/06/webgl-environment-with-typescript/","result":{"data":{"markdownRemark":{"html":"<p>グラフィックスの勉強をちゃんとしたいとふと思い（思い立つが手が動かせてなかった）、興味があったWebGLを触ろうと思い、この環境をwebpackで整えました。</p>\n<p>自分がウェブを仕事でやっているわけでなくて詳しくないので、ツッコミなどは大歓迎です。<a href=\"https://twitter.com/yucchiy_\">@yucchiy_</a> までご連絡いただけると幸いです。</p>\n<h2 id=\"やりたいこと\" style=\"position:relative;\"><a href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\" aria-label=\"やりたいこと permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>やりたいこと</h2>\n<ul>\n<li>TypeScriptベースで開発したい</li>\n<li>モデルやテクスチャのロード対応</li>\n<li>シェーダーについては別シェーダーのインポート・エクスポートもできるようにしたい</li>\n</ul>\n<p>グラフィックス系の実装なので比較的記述するコードが複雑でかつ量も多くなりそうなのと、WebGLのAPIを叩くときの引数や戻り値のヒントとして、ある程度型がついていて、IDEで確認できると良いな、ということでTypeScriptを選択しました。</p>\n<h2 id=\"必要なモジュールのインストール\" style=\"position:relative;\"><a href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"必要なモジュールのインストール permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>必要なモジュールのインストール</h2>\n<p>下記モジュールをインストールします。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">$ npm install <span class=\"token operator\">--</span>save<span class=\"token operator\">-</span>dev webpack webpack<span class=\"token operator\">-</span>cli  webpack<span class=\"token operator\">-</span>dev<span class=\"token operator\">-</span>server \\\n    typescript ts<span class=\"token operator\">-</span>loader \\\n    html<span class=\"token operator\">-</span>webpack<span class=\"token operator\">-</span>plugin \\\n    raw<span class=\"token operator\">-</span>loader glslify<span class=\"token operator\">-</span>loader</code></pre></div>\n<p>主に下記用途です。</p>\n<ul>\n<li><code>webpack</code> ・ <code>webpack-cli</code> ・ <code>webpack-dev-server</code>\n<ul>\n<li>webpack本体やwebpackでのローカルサーバー構築。</li>\n</ul>\n</li>\n<li><code>typescript</code> ・ <code>ts-loader</code>\n<ul>\n<li>TypeScriptでアプリを開発するため。</li>\n</ul>\n</li>\n<li><code>html-webpack-plugin</code>\n<ul>\n<li>webpackでHTMLの生成も行う。複数HTMLも生成できる。</li>\n</ul>\n</li>\n<li><code>raw-loader</code> ・ <code>glslify-loader</code>\n<ul>\n<li>テクスチャやモデル、シェーダー読み込みと、シェーダーのモジュール化のため。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"webpackの設定\" style=\"position:relative;\"><a href=\"#webpack%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"webpackの設定 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>webpackの設定</h2>\n<p>そこまで複雑ではないので、まず全文記載します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> HtmlWebpackPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html-webpack-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> debug <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/entrypoint.ts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">templateParameters</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">'MiniEngein'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">inject</span><span class=\"token operator\">:</span> <span class=\"token string\">'body'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'bundle.js'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">extensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(frag|vert|glsl)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token string\">'/node_modules/'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string\">'raw-loader'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">'glslify-loader'</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(tsx|ts)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string\">'ts-loader'</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span> debug <span class=\"token operator\">?</span> <span class=\"token string\">'development'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">devtool</span><span class=\"token operator\">:</span> debug <span class=\"token operator\">?</span> <span class=\"token string\">'eval-source-map'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'source-map'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"https://github.com/yucchiy/MiniEngine\">yucchiy/MiniEngine</a>でも<a href=\"https://github.com/yucchiy/MiniEngine/blob/bd6bd24a767fa7e67edc88ece1d0f71a7f9d664c/webpack.config.js\">確認できます</a>。</p>\n<p>上記の設定について解説していきます。</p>\n<h3 id=\"ディレクトリ構成とhtml\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90%E3%81%A8html\" aria-label=\"ディレクトリ構成とhtml permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ディレクトリ構成とHTML</h3>\n<p>今回用意した環境は、大まかに下記のディレクトリ構成となります。</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">.\n├── package-lock.json\n├── package.json\n├── src\n│   ├── app\n│   │   ├── glsl\n│   │   └── ts\n│   ├── entrypoint.ts\n│   └── index.html\n├── tsconfig.json\n└── webpack.config.js</code></pre></div>\n<ul>\n<li><code>src/entrypoint.ts</code> がエントリーポイントとなるTypeScipt\n<ul>\n<li><code>src/index.html</code> が上記エントリーポイントを読み込むHTMLファイル</li>\n</ul>\n</li>\n<li><code>src/app</code> 以下に実際のアプリを開発する\n<ul>\n<li><code>src/app/glsl</code> にシェーダーファイルを配置する</li>\n<li><code>src/app/ts</code> 以下にTypeScriptを配置する</li>\n</ul>\n</li>\n</ul>\n<p>上記の設定を、 <code>webpack.config.js</code> 内で下記のように設定しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/entrypoint.ts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">templateParameters</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">'MiniEngein'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">inject</span><span class=\"token operator\">:</span> <span class=\"token string\">'body'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h3 id=\"typescriptのロード\" style=\"position:relative;\"><a href=\"#typescript%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89\" aria-label=\"typescriptのロード permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TypeScriptのロード</h3>\n<p>開発にTypeScriptを利用したいため、 <code>ts-loader</code> を設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">extensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(tsx|ts)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string\">'ts-loader'</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span></code></pre></div>\n<p>この設定を行うことで、TypeScriptを配置してロードすると読み込み時に自動でJavaScriptにトランスパイルして利用されます。</p>\n<p>TypeScriptの設定である <code>tsconfig.json</code> は下記のようにしました。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ES2015\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"strict\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"esModuleInterop\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"skipLibCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"forceConsistentCasingInFileNames\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"$schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://json.schemastore.org/tsconfig\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"シェーダーのロード\" style=\"position:relative;\"><a href=\"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89\" aria-label=\"シェーダーのロード permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>シェーダーのロード</h3>\n<p>シェーダーもテクスチャと同様に、 <code>raw-loader</code> を利用することで、TypeScriptコード中に <code>import</code> を用いてロードできるようにしています。ただしシェーダーの場合、シェーダー中に別シェーダーの関数を呼び出したいので、さらに <code>glslify-loader</code> を通しています。</p>\n<p>下記を <code>webpack.config.js</code> に記載します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(frag|vert|glsl)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token string\">'/node_modules/'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string\">'raw-loader'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">'glslify-loader'</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>シェーダーコードは、インポート時に <code>string</code> として利用したいので、 <code>src/app/glsl</code> 以下に <code>glsl.d.ts</code> を配置して、下記を記述します。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.vert'</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> src<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> src<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.frag'</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> src<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> src<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.glsl'</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> src<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> src<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>これで、 <code>vert</code> ・ <code>frag</code> ・ <code>glsl</code> 拡張子のシェーダーファイルをインポートで読み込む際は、下記コードのように <code>string</code> としてインポートされます。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// \"../glsl/HelloTriangleScene/vertex.glsl\"と</span>\n<span class=\"token comment\">// \"../glsl/HelloTriangleScene/fragment.glsl\"をロード</span>\n<span class=\"token keyword\">import</span> VertexShaderSource <span class=\"token keyword\">from</span> <span class=\"token string\">\"../glsl/HelloTriangleScene/vertex.glsl\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> FragmentShaderSource <span class=\"token keyword\">from</span> <span class=\"token string\">\"../glsl/HelloTriangleScene/fragment.glsl\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloTriangleScene</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseScene</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>ctx<span class=\"token operator\">:</span> GameContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// VertexShaderSourceおよびFragmentShaderSourceに</span>\n        <span class=\"token comment\">// stringとしてシェーダーコードが格納されている</span>\n        <span class=\"token keyword\">var</span> vertexShader <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">createVertexShader</span><span class=\"token punctuation\">(</span>VertexShaderSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> fragmentShader <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">createVertexShader</span><span class=\"token punctuation\">(</span>fragmentShaderSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>また、 <code>glslify-loader</code> を用いることで、下記のようにシェーダーコード内での別シェーダーファイルの読み込みを行えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"glsl\"><pre class=\"language-glsl\"><code class=\"language-glsl\"><span class=\"token comment\">// my-function.glsl</span>\n<span class=\"token keyword\">float</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">vec3</span> normal<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">dot</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">vec3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// myFunctionをエクスポートして別ファイルから利用できるようにする</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">glslify<span class=\"token operator\">:</span> <span class=\"token function\">export</span><span class=\"token punctuation\">(</span>myFunction<span class=\"token punctuation\">)</span></span></span>\n\n\n<span class=\"token comment\">// 同フォルダ内のglslファイル</span>\n<span class=\"token comment\">// my-function.glslのmyFunctionをインポートして利用する</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\">glslify<span class=\"token operator\">:</span> topDot <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>my<span class=\"token operator\">-</span>function<span class=\"token punctuation\">.</span>glsl<span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token function\">topDot</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">vec3</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span></code></pre></div>\n<h2 id=\"ローカルの開発サーバーの立ち上げ\" style=\"position:relative;\"><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AE%E9%96%8B%E7%99%BA%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92\" aria-label=\"ローカルの開発サーバーの立ち上げ permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ローカルの開発サーバーの立ち上げ</h2>\n<p><code>webpack-dev-server</code> でローカルの開発サーバーを立ち上げて開発します。また、サーバーを立ち上げている最中にコードを書き換えた場合は、自動でリロードが走るようにします。</p>\n<p><code>package.json</code> の <code>scripts</code> 項目に下記を追記します。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"develop\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-dev-server --progress --hot\"</span></code></pre></div>\n<p>実際にサーバーを立ち上げるには、下記コマンドを実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\"># `webpack-dev-server --progress --hot` が呼び出される\n$ npm run develop</code></pre></div>\n<p>特に設定をしていない場合は、 <a href=\"http://localhost:8080\">http://localhost:8080</a> で確認できます。</p>\n<h2 id=\"成果物の作成\" style=\"position:relative;\"><a href=\"#%E6%88%90%E6%9E%9C%E7%89%A9%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"成果物の作成 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>成果物の作成</h2>\n<p>成果物を <code>public</code> ディレクトリに書き出すようにします。まず、 <code>webpack.config.js</code> の <code>output</code> 項目に下記を記述します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'bundle.js'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>次に <code>package.json</code> の <code>scripts</code> に下記を記述します。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>実際にビルドするには下記コマンドを実行します。成功すると <code>public</code> に成果物が吐き出されるので、これを適当なサーバーに配置します。</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">$ npm run build</code></pre></div>\n<h2 id=\"エディタ環境\" style=\"position:relative;\"><a href=\"#%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E7%92%B0%E5%A2%83\" aria-label=\"エディタ環境 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>エディタ環境</h2>\n<p>VSCodeに<a href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode.vscode-typescript-next\">TypeScriptのプラグイン</a>を導入して開発しています。これによって、WebGLのAPI呼び出し時の補完や型によるヒントが下記のように表示されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/be4a1eebbe22a41906e7902d773c2d0a/6029f/D3192936BD76B505E822189B3B42641A.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSElEQVQoz32RW27bMBBFtY6EnOFLFCVKimUnbqwEaAsUyf5XdArJTeG0RT8uL8HHnTOYRlRxqScNB3KdiFOlfRiJDyPSZULX47uC9hlfOmIu+NSS+oqWljD0eBew1iIiNNviY8fx+QfL8zfquvK0njkuM6UUhi5TS8ZHj3iP8x51Dhci4h0aAiL6OVDUoSKoKMYaxBictbitmApBtzuLNXb/uMuYT77lbN6IWFzsKKcX6vFMNx72tsz28Ncja2Xfy390Q2jR2DO+vLO8fuf09Y3U9dzf3WGtuRIYsxe41Qfpn8GNqpJixPtwJbFCCIGcMz5lXLwqpkRKaT/f3Dn/m+xWjVNlOsw8ns7UcSKmyPnLhfVyoZ5W4vhImp4Yp5lpmlmWI/M007aZDeYvwi1QNRG6gaEW6jjgY9rblG1A9n73DwJzM4R/6SezrOC/i8MdOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"D3192936BD76B505E822189B3B42641A\"\n        title=\"D3192936BD76B505E822189B3B42641A\"\n        src=\"/static/be4a1eebbe22a41906e7902d773c2d0a/5a190/D3192936BD76B505E822189B3B42641A.png\"\n        srcset=\"/static/be4a1eebbe22a41906e7902d773c2d0a/772e8/D3192936BD76B505E822189B3B42641A.png 200w,\n/static/be4a1eebbe22a41906e7902d773c2d0a/e17e5/D3192936BD76B505E822189B3B42641A.png 400w,\n/static/be4a1eebbe22a41906e7902d773c2d0a/5a190/D3192936BD76B505E822189B3B42641A.png 800w,\n/static/be4a1eebbe22a41906e7902d773c2d0a/6029f/D3192936BD76B505E822189B3B42641A.png 906w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>シンボル名のリネームなどのリファクタリングもある程度しっかりと行えるので、開発体験としてはかなりいい感じです。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://webpack.js.org/plugins/html-webpack-plugin/\">HtmlWebpackPlugin | webpack</a></li>\n<li><a href=\"https://webpack.js.org/guides/typescript/\">TypeScript | webpack</a></li>\n<li><a href=\"https://qiita.com/ryokkkke/items/390647a7c26933940470\">tsconfig.jsonの全オプションを理解する（随時追加中） - Qiita</a></li>\n<li><a href=\"https://qiita.com/takeokunn/items/fd9e0ee378fac852968e\">WebGLのTypeScript環境作ってみた - Qiita</a></li>\n<li><a href=\"https://blog.shogonir.jp/entry/2020/01/20/005229\">TypeScriptとWebGLでポリゴンを描画する方法 - shogonir blog</a></li>\n</ul>","excerpt":"グラフィックスの勉強をちゃんとしたいとふと思い（思い立つが手が動かせてなかった）、興味があったWebGLを触ろうと思い、この環境をwebpackで整えました。 自分がウェブを仕事でやっているわけでなくて詳しくないので、ツッコミなどは大歓迎です。@yucchiy_ までご連絡いただけると幸いです。 やりたいこと TypeScript…","fields":{"slug":"/articles/2022/06/webgl-environment-with-typescript/"},"frontmatter":{"date":"June 05, 2022","type":"tech","tags":["グラフィックス","TypeScript","WebGL","webpack","yatteiki"],"title":"TypeScriptで記述できるWebGL環境をwebpackで構築する","description":"TypeScriptで記述できるWebGLの開発環境をwebpackにより整えたので、各種設定方法についてまとめます。","eyecatch":{"publicURL":"/static/759a2f67ec9be9b56528e93a3fb7924d/0E2283A42C180D858EBE20ED5A7509A6.png"}}}},"pageContext":{"id":"8f1ea91b-2fdb-56c0-9365-9e6984c4d1ee"}},"staticQueryHashes":["1480509143","3159585216"]}