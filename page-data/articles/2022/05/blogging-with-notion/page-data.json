{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2022/05/blogging-with-notion/","result":{"data":{"markdownRemark":{"html":"<p>最近はNotionでブログを書いて、そこからMarkdownでエクスポートし、それを<strong>手作業で</strong>ブログレポジトリにプッシュしていました。</p>\n<p>流石に効率が悪いなと思っていたのと、「<a href=\"https://r7kamura.com/articles/2022-04-30-google-docs-for-blogging\">Googleドキュメントでブログを書く</a>」という記事を読んで、そのワークフローがとても参考になったので、自分のブログもNotionでブログを書けるようにしてみました。</p>\n<h2 id=\"ブログ投稿までの流れ\" style=\"position:relative;\"><a href=\"#%E3%83%96%E3%83%AD%E3%82%B0%E6%8A%95%E7%A8%BF%E3%81%BE%E3%81%A7%E3%81%AE%E6%B5%81%E3%82%8C\" aria-label=\"ブログ投稿までの流れ permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ブログ投稿までの流れ</h2>\n<p>大まかには下記の流れで、記事執筆からブログ更新までをおこなうようにしました。</p>\n<ol>\n<li>Notion（のデータベース）に記事を執筆する。執筆が完了したら、記事投稿用のチェックを入れる。</li>\n<li>定期スケジュールされたGitHub Actionsで、1. からmarkdownを書き出し、ブログレポジトリの記事用ディレクトリにプッシュする。</li>\n<li>ブログレポジトリへのプッシュをトリガーに、記事をデプロイする。</li>\n</ol>\n<p><strong>ブログ執筆から投稿までをNotionの操作で完結させたかった</strong>ので、投稿したい記事を示すチェックボックスをプロパティに設けることにしました。定期的に、そのプロパティにチェックが入った記事のみを書き出すようにしています。</p>\n<p>ブログレポジトリはgitで管理されているため、Notionデータベース内の全記事を書き出して、gitとして差分があれば更新でもよかったんですが、記事を書き出すのに結構な回数APIを叩く必要があり、若干無駄に感じました。</p>\n<p>あとそもそも定期チェックで記事を投稿するので、執筆中の記事が勝手に上がってしまうのは嫌なのと、そのために下書きフラグを１つ持つのであれば、更新フラグを１つ持つのとコストは変わらないな、と思いこの方式にしました。</p>\n<h2 id=\"notion-to-markdown\" style=\"position:relative;\"><a href=\"#notion-to-markdown\" aria-label=\"notion to markdown permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>notion-to-markdown</h2>\n<p><a href=\"https://github.com/yucchiy/notion-to-markdown\">notion-to-markdown</a>は、markdownをローカルに書き出すCustom GitHub Actionsです。</p>\n<p>ブログレポジトリへの記事のプッシュは、下記のアクションを定義することで実現しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> import\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'0/10 * * * *'</span>\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">import_markdown</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.MY_GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Export The Notion Database to local markdown files.\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> export\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> yucchiy/notion<span class=\"token punctuation\">-</span>to<span class=\"token punctuation\">-</span>markdown@v0.2.1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">notion_auth_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.NOTION_AUTH_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">notion_database_id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.NOTION_DATABASE_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">output_directory_path_template</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"./src/pages/{{publish|date.to_string('%Y/%m')}}/{{slug}}\"</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit exported markdown files\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.export.outputs.exported_count <span class=\"token tag\">!=</span> '0' <span class=\"token punctuation\">|</span><span class=\"token punctuation\">|</span> steps.export_unity_weekly.outputs.exported_count <span class=\"token tag\">!=</span> '0' <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          git config --local user.email \"41898282+github-actions[bot]@users.noreply.github.com\"\n          git config --local user.name \"github-actions[bot]\"\n          git add ./src/pages\n          git commit -m \"Import files from notion database\"</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push markdown files\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> ad<span class=\"token punctuation\">-</span>m/github<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@master\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.MY_GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.ref <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>上記コードのように、notion-to-markdownを実行して、書き出されたファイル数が１つでもあればコミット＆プッシュを行うようにしています。</p>\n<p>実装はC#で行い、Notionライブラリには<a href=\"https://github.com/notion-dotnet/notion-sdk-net\">notion-dotnet/notion-sdk-net</a>を用いました。（この辺は別記事で）</p>\n<h2 id=\"なぜnotionか\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%9Cnotion%E3%81%8B\" aria-label=\"なぜnotionか permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なぜNotionか？</h2>\n<p>このブログは <a href=\"https://blog.yucchiy.com/2020/02/deployment-to-self-hosted-server-for-gatsbyjs/\">Gatsby.js で静的ファイルを書き出すことで記事をブログを投稿しています</a>。特定のディレクトリ階層下にmarkdownファイル（と画像などのアセット）を配置し、ビルドコマンドでhtmlやjs、GraphQLファイルを吐き出し、それをデプロイしています。</p>\n<p>一時期、<a href=\"https://neue.cc/2021/11/21.html\">この記事</a>を参考にGitHub web-based editorで記事で直接レポジトリ上でmarkdownファイルを編集していて、それはそれで便利（ローカルに Gatsby.js 環境を構築する必要がないため）だったのですが、ブログ執筆ごとに特定ディレクトリを掘ったりするのが面倒でした。</p>\n<p>あと、特に画像の貼り付けるのにディレクトリに画像を配置して、そのパスをコピーするのが結構面倒でした。Notion だと画像の貼り付けは楽なのと、notion-to-markdownでは画像の書き出してて、相対パスで記事中にリンクするようにしたので、かなり体験が良くなりました。</p>\n<p>また、地味にですが、スマホから記事が書けるのも体験として良いです。ガッツリ全部書き切るというより、思いついた時に記事の大枠をスマホで書いておき、あとでPCで細かいところと肉付けするみたいなやり方が、コロナが収束し始めて通勤時間が増えてきた今、隙間時間の使い方に良くマッチしている気がします。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>notion-to-markdown によるnotionを用いたブログ執筆について紹介しました。</p>\n<p>これでより記事が書きやすくなったため、記事執筆数も増えるはず…。</p>","excerpt":"最近はNotionでブログを書いて、そこからMarkdownでエクスポートし、それを手作業でブログレポジトリにプッシュしていました。 流石に効率が悪いなと思っていたのと、「Googleドキュメントでブログを書く」という記事を読んで、そのワークフローがとても参考になったので、自分のブログもNotionでブログを書けるようにしてみました。 ブログ投稿までの流れ 大まかには下記の流れで、記事執筆からブログ更新までをおこなうようにしました。 Notion…","fields":{"slug":"/articles/2022/05/blogging-with-notion/"},"frontmatter":{"date":"May 27, 2022","type":"tech","tags":["ブログ環境","Notion","C#","GitHub Actions"],"title":"Notionでブログを書く","description":"Gatsby.jsで作成しているこのブログの執筆から投稿までをNotionで行えるようにしました。この対応について紹介します。","eyecatch":null}}},"pageContext":{"id":"9465c451-7b4e-517a-9b64-521d57cb3550"}},"staticQueryHashes":["1480509143","3159585216"]}