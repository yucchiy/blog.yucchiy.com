{"componentChunkName":"component---src-templates-post-tsx","path":"/2021/10/unity-share-code-with-unitypackage/","result":{"data":{"markdownRemark":{"html":"<p>Unityでコードを共有する方法として、最近ではPackage Managerを用いる方法が主流ですが、\r\n<code>.unitypackage</code>を利用すると気軽にコードが共有でき、アセットやメタ情報も正しく共有できるので便利だなって感じたので、\r\nメモとして<code>.unitypackage</code>のエクスポートやインポートをスクリプトやコマンドラインで行う方法をブログに残しておきます。</p>\n<h2 id=\"unitypackageのエクスポートをスクリプト経由で行う\" style=\"position:relative;\"><a href=\"#unitypackage%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%82%92%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E7%B5%8C%E7%94%B1%E3%81%A7%E8%A1%8C%E3%81%86\" aria-label=\"unitypackageのエクスポートをスクリプト経由で行う permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>.unitypackageのエクスポートをスクリプト経由で行う</h2>\n<p><code>AssetDatabase</code>には<code>ExportPackage</code>というメソッドがあり、これをもちいることで<code>.unitypackage</code>を出力できます。</p>\n<p><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase.ExportPackage.html\">Unity - Scripting API: AssetDatabase.ExportPackage</a></p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\">AssetDatabase<span class=\"token punctuation\">.</span><span class=\"token function\">ExportPackage</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span>\r\n    <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">\"Assets/Plugins\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"Assets/Prefabs\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"Assets/Scripts/Runtime\"</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"Assets/TextMesh Pro\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"ShareShitaiCode.unitypackage\"</span><span class=\"token punctuation\">,</span>\r\n    ExportPackageOptions<span class=\"token punctuation\">.</span>Recurse <span class=\"token operator\">|</span>\r\n    ExportPackageOptions<span class=\"token punctuation\">.</span>IncludeDependencies\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>第１引数はパッケージに書き出すパスの一覧。後述する <code>ExportPackageOptions.Recurse</code> を用いることで、パスにフォルダを指定すると配下のデータをまとめて書き出すこともできます。\r\nまた、<code>ExportPackageOptions.IncludeDependencies</code> を指定すると、例えば <code>.prefab</code> を指定したらそのプレハブが内部で利用しているアセットもまとめて書き出せます。</p>\n<p>第２引数は出力するパッケージ名です。</p>\n<p>第３引数はパッケージ書き出しのオプションで、フラグなのでORで結合して複数指定できます。指定できるオプションは下記のとおりです。</p>\n<ul>\n<li><code>Default</code>: 省略した場合のデフォルト挙動。指定したファイルのみを含める。依存やサブディレクトリ、ライブラリの設定などを含めない。</li>\n<li><code>Recurse</code> 指定したパスのサブディレクトリおよびそのディレクトリ内部のすべてのアセットをパッケージに含める。</li>\n<li><code>IncludeDependencies</code> 指定したファイルが依存しているアセットも含める。</li>\n<li><code>IncludeLibraryAssets</code> プロジェクト設定やライブラリフォルダなどのライブラリアセットも含める。</li>\n</ul>\n<p>所管としては、単純なコードやアセット共有では<code>ExportPackageOptions.Recurse</code>と<code>ExportPackageOptions.IncludeDependencies</code>を指定することが多そうと感じました。</p>\n<h2 id=\"unitypackageのインポートをスクリプト経由で行う\" style=\"position:relative;\"><a href=\"#unitypackage%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88%E3%82%92%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E7%B5%8C%E7%94%B1%E3%81%A7%E8%A1%8C%E3%81%86\" aria-label=\"unitypackageのインポートをスクリプト経由で行う permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>unitypackageのインポートをスクリプト経由で行う</h2>\n<p>次に書き出した<code>.unitypackage</code>のインポートです。<code>.unitypackage</code>のインポートはスクリプト経由からも行えます。</p>\n<p><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase.ImportPackage.html\">Unity - Scripting API: AssetDatabase.ImportPackage</a></p>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEditor</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AssetDatabaseExamples</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehaviour</span></span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">MenuItem</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"Window/ImportBenriPackage\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\r\n    <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ImportPackageExample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        AssetDatabase<span class=\"token punctuation\">.</span><span class=\"token function\">ImportPackage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BenriCode.unitypackage\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>第１引数にインポートする対象のパッケージのパスを、第２引数には<code>interactive</code>オプションを指定します。\r\n<code>true</code>の場合、GUI経由でパッケージインポートする際にでてくるアセットリストの選択ウインドウ等が表示されます。（つまりGUI経由でのパッケージインポートと同じ挙動となります）</p>\n<h3 id=\"インポート時のコールバック\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88%E6%99%82%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF\" aria-label=\"インポート時のコールバック permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>インポート時のコールバック</h3>\n<p>ちなみにパッケージのインポート前後になにか処理を差し込みたい場合は、下記のコールバックが利用できます。</p>\n<ul>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase-importPackageCancelled.html\">AssetDatabase.importPackageCancelled</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase-importPackageCompleted.html\">AssetDatabase.importPackageCompleted</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase-importPackageFailed.html\">AssetDatabase.importPackageFailed</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase-importPackageStarted.html\">AssetDatabase.importPackageStarted</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">// from: https://docs.unity3d.com/ScriptReference/AssetDatabase-importPackageStarted.html</span>\r\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEditor</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// この属性をつけないとコールバックの登録がされないので注意</span>\r\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">InitializeOnLoad</span></span><span class=\"token punctuation\">]</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AssetDatabaseExamples</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">static</span> <span class=\"token function\">AssetDatabaseExamples</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        AssetDatabase<span class=\"token punctuation\">.</span>importPackageStarted <span class=\"token operator\">+=</span> OnImportPackageStarted<span class=\"token punctuation\">;</span>\r\n        AssetDatabase<span class=\"token punctuation\">.</span>importPackageCompleted <span class=\"token operator\">+=</span> OnImportPackageCompleted<span class=\"token punctuation\">;</span>\r\n        AssetDatabase<span class=\"token punctuation\">.</span>importPackageFailed <span class=\"token operator\">+=</span> OnImportPackageFailed<span class=\"token punctuation\">;</span>\r\n        AssetDatabase<span class=\"token punctuation\">.</span>importPackageCancelled <span class=\"token operator\">+=</span> OnImportPackageCancelled<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnImportPackageCancelled</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> packageName<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Cancelled the import of package: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">packageName</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnImportPackageCompleted</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> packagename<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Imported package: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">packagename</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnImportPackageFailed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> packagename<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> errormessage<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Failed importing package: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">packagename</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> with error: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">errormessage</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnImportPackageStarted</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> packagename<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">{</span>\r\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Started importing package: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">packagename</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"unitypackageのインポートをコマンドライン経由で行う\" style=\"position:relative;\"><a href=\"#unitypackage%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88%E3%82%92%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E7%B5%8C%E7%94%B1%E3%81%A7%E8%A1%8C%E3%81%86\" aria-label=\"unitypackageのインポートをコマンドライン経由で行う permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>.unitypackageのインポートをコマンドライン経由で行う</h2>\n<p><code>.unitypackage</code>はコマンドライン経由でインポートを行うこともできます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ /path/to/unity -projectPath /path/to/targetproject -importPackage /path/to/unitypackage -logFile /path/to/logfile -batchmode -nographics -quit</code></pre></div>\n<p><code>/path/to/*</code>にはそれぞれのパスがはいります。GUI経由だとパッケージのインストール時にどのスクリプトをインストールするか選択できますが、コマンドライン経由の場合はパッケージングされているすべてのデータが自動的にインポートされるようです。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://kan-kikuchi.hatenablog.com/entry/Unitypackage\">Unitypackageの使い方(インポート)や作り方(エクスポート)、プログラムでの操作方法【Unity】【エディタ拡張】 - (:3[kanのメモ帳]</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase.ExportPackage.html\">Unity - Scripting API: AssetDatabase.ExportPackage</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase-importPackageStarted.html\">AssetDatabase.importPackageStarted</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/AssetDatabase.ImportPackage.html\">Unity - Scripting API: AssetDatabase.ImportPackage</a></li>\n</ul>","excerpt":"Unityでコードを共有する方法として、最近ではPackage Managerを用いる方法が主流ですが、\r\n.unitypackageを利用すると気軽にコードが共有でき、アセットやメタ情報も正しく共有できるので便利だなって感じたので、\r\nメモとして.unitypackageのエクスポートやインポートをスクリプトやコマンドラインで行う方法をブログに残しておきます。 .unitypackageのエクスポートをスクリプト経由で行う AssetDatabaseにはExportPackage…","fields":{"slug":"/2021/10/unity-share-code-with-unitypackage/"},"frontmatter":{"date":"October 12, 2021","type":null,"tags":["Unity","unitypackage","UnityEditor"],"title":".unitypackageを介してコード共有をおこなう、または.unitypackageのエクスポート・インポートをスクリプト・CLIで行う方法","description":null,"eyecatch":null}}},"pageContext":{"id":"dad1821b-4937-52bd-874c-e6322fd4fa99"}},"staticQueryHashes":["1480509143","3159585216"]}